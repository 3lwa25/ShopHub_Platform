{% load static %}

<!-- Product Card Component -->
<div class="product-card card h-100 shadow-sm">
    {% if product.is_on_sale %}
    <div class="position-absolute top-0 end-0 m-2">
        <span class="badge bg-danger">{{ product.discount_percentage }}% OFF</span>
    </div>
    {% endif %}
    
    {% if not product.is_in_stock %}
    <div class="position-absolute top-0 start-0 m-2">
        <span class="badge bg-secondary">Out of Stock</span>
    </div>
    {% endif %}
    
    {% if product.is_best_seller %}
    <div class="position-absolute top-0 start-0 m-2" style="z-index: 2;">
        <span class="badge bg-warning text-dark">
            <i class="fas fa-trophy"></i> Best Seller
        </span>
    </div>
    {% endif %}
    
    <!-- Product Image -->
    <a href="{% url 'products:product_detail' product.slug %}" class="text-decoration-none">
        {% with primary_image=product.images.all|first %}
        <img 
            src="{% if primary_image %}{{ primary_image.image.url }}{% else %}{% static 'images/placeholder-product.jpg' %}{% endif %}" 
            class="card-img-top product-img" 
            alt="{{ product.title }}"
            loading="lazy"
        >
        {% endwith %}
    </a>
    
    <!-- Quick Action Buttons -->
    <div class="product-quick-actions">
        <button class="btn btn-sm btn-light" onclick="quickView('{{ product.slug }}')" title="Quick View">
            <i class="fas fa-eye"></i>
        </button>
        {% if user.is_authenticated and not user.is_seller %}
        <button class="btn btn-sm btn-light wishlist-toggle-btn" 
                data-product-id="{{ product.id }}" 
                title="Add to Wishlist">
            <i class="far fa-heart wishlist-icon" id="wishlist-icon-{{ product.id }}"></i>
        </button>
        {% endif %}
    </div>
    
    <div class="card-body">
        <!-- Category -->
        {% if product.category %}
        <p class="text-muted small mb-1">
            <i class="fas fa-tag"></i> {{ product.category.name }}
        </p>
        {% endif %}
        
        <!-- Product Title -->
        <h5 class="card-title">
            <a href="{% url 'products:product_detail' product.slug %}" class="text-dark text-decoration-none">
                {{ product.title|truncatewords:8 }}
            </a>
        </h5>
        
        <!-- Rating -->
        <div class="mb-2">
            {% if product.review_count > 0 %}
            <div class="d-flex align-items-center">
                <div class="stars text-warning me-1">
                    {% for i in "12345" %}
                        {% if forloop.counter <= product.rating|floatformat:"0" %}
                        <i class="fas fa-star"></i>
                        {% else %}
                        <i class="far fa-star"></i>
                        {% endif %}
                    {% endfor %}
                </div>
                <small class="text-muted">({{ product.review_count }})</small>
            </div>
            {% else %}
            <div class="text-muted small">
                <i class="far fa-star"></i> No reviews yet
            </div>
            {% endif %}
        </div>
        
        <!-- Price -->
        <div class="mb-2">
            <span class="h5 text-primary mb-0">EGP {{ product.price }}</span>
            {% if product.compare_at_price %}
            <span class="text-muted text-decoration-line-through ms-2">
                EGP {{ product.compare_at_price }}
            </span>
            {% endif %}
        </div>
        
        <!-- Seller -->
        <p class="text-muted small mb-2">
            <i class="fas fa-store"></i> {{ product.seller.business_name|default:"Shop Hub" }}
        </p>
        
        <!-- Stock Status -->
        {% if product.is_in_stock %}
            {% if product.is_low_stock %}
            <p class="text-warning small mb-2">
                <i class="fas fa-exclamation-circle"></i> Only {{ product.stock }} left
            </p>
            {% else %}
            <p class="text-success small mb-2">
                <i class="fas fa-check-circle"></i> In Stock
            </p>
            {% endif %}
        {% else %}
        <p class="text-danger small mb-2">
            <i class="fas fa-times-circle"></i> Out of Stock
        </p>
        {% endif %}
    </div>
    
    <div class="card-footer bg-transparent border-top-0">
        <div class="d-grid gap-2">
            {% if product.is_in_stock %}
                {% if can_shop %}
                <button class="btn btn-primary btn-sm add-to-cart-btn" data-product-id="{{ product.id }}">
                    <i class="fas fa-shopping-cart"></i> Add to Cart
                </button>
                {% else %}
                <button class="btn btn-secondary btn-sm" disabled>
                    <i class="fas fa-info-circle"></i> Sellers cannot checkout
                </button>
                {% endif %}
            {% else %}
            <button class="btn btn-secondary btn-sm" disabled>
                <i class="fas fa-ban"></i> Out of Stock
            </button>
            {% endif %}
        </div>
    </div>
</div>


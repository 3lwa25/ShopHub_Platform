{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Shophub</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-image: url('{% static "images/Backgroud.jpg" %}');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 0; /* Add padding for smaller screens */
        }

        .login-card {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
            width: 90%;
            max-width: 1100px;
            min-height: 600px; /* Use min-height for flexibility */
            display: flex;
            overflow: hidden; /* Ensure rounded corners apply to children */
        }

        .custom-input {
            width: 100%;
            padding: 0.75rem 1rem; /* py-3 px-4 */
            border-radius: 0.75rem; /* rounded-xl */
            border: none;
            background-color: #f3f4f6; /* bg-gray-100 */
            color: #111827;
            transition: all 0.15s;
        }

        .custom-input::placeholder {
            color: #6b7280;
        }

        .custom-input:focus {
            outline: none;
            ring: 2px;
            ring-color: #2563eb;
            background-color: #fff;
            box-shadow: 0 0 0 2px #2563eb;
        }

        .illustration-panel {
            background-color: #2c3e50;
            background-image: url('{% static "images/illust.png" %}');
            background-size: contain; /* WAS: cover */
            background-position: center center;
            background-repeat: no-repeat; /* Added this */
            position: relative;
            overflow: hidden;
            width: 50%;
            flex-shrink: 0; /* Prevent panel from shrinking */
        }

        .shophub-logo {
            position: absolute;
            top: 30px;
            left: 30px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 10;
        }

        .shophub-logo img {
            width: 80px; /* Was 40px */
            height: 80px; /* Was 40px */
            object-fit: contain;
            display: block;
        }

        .shophub-logo span {
            font-size: 2.5rem; /* Was 1.5rem */
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .circles-image-left {
            /* REMOVED THIS ENTIRE RULE */
        }

        .welcome-text {
            position: absolute;
            bottom: 40px;
            left: 40px;
            font-size: 5rem; /* Was 5.5rem */
            font-weight: 800;
            line-height: 1;
            color: white;
            z-index: 2;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .primary-btn {
            background-color: #3452B3;
            transition: all 0.2s;
        }

        .primary-btn:hover {
            background-color: #2e47a0;
        }

        .primary-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }


        @media (max-width: 768px) {
            body {
                padding: 20px; /* Ensure padding on mobile */
                align-items: flex-start; /* Align card to top on mobile */
            }
            .login-card {
                flex-direction: column;
                height: auto; /* Auto height for content */
                max-width: 100%;
                width: 100%;
                min-height: 0;
            }
            
            .illustration-panel {
                width: 100% !important;
                height: 250px; /* Reduced height for mobile */
            }

            .shophub-logo {
                top: 20px;
                left: 20px;
                gap: 10px;
            }

            .shophub-logo img {
                width: 50px; /* Was 32px */
                height: 50px; /* Was 32px */
            }

            .shophub-logo span {
                font-size: 1.75rem; /* Was 1.25rem */
            }

            .circles-image-left {
                /* REMOVED THIS ENTIRE RULE */
            }
            
            .welcome-text {
                font-size: 2.5rem;
                bottom: 20px;
                left: 20px;
            }
            
            .form-panel {
                width: 100% !important;
                padding: 2.5rem 1.5rem !important; /* Reduced padding for mobile */
            }
        }

        /* Error message styling */
        .error-message {
            background-color: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.875rem;
        }

        /* Loading spinner */
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #fff; /* Changed to white for contrast on blue btn */
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Ensure images load properly */
        img {
            max-width: 100%;
            height: auto;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'shophub-blue': '#2c3e50',
                        'primary-btn': '#3452B3',
                    }
                }
            }
        }
    </script>
</head>
<body>
    <!-- Main Login Card Container -->
    <div class="login-card bg-white rounded-[2rem]">
        <!-- Left Side: Illustration and Welcome Message -->
        <div class="illustration-panel text-white">
            <!-- Logo and Brand Name at Top Left -->
            <div class="shophub-logo">
                <img 
                    src="{% static 'images/logo.png' %}" 
                    alt="Shophub Logo" 
                    class="logo-img"
                >
                <span>Shophub</span>
            </div>

            <!-- Circles at Top Right -->
            <!-- REMOVED: <img src="{% static 'images/circles.png' %}" alt="Decorative circles" class="circles-image-left"> -->

            <!-- Welcome Text -->
            <h1 class="welcome-text">Welcome!</h1>
        </div>

        <!-- Right Side: Login Form -->
        <div class="w-1/2 p-16 flex flex-col justify-center space-y-8 relative form-panel">
            
            <!-- Decorative circles (from image) -->
            <img src="{% static 'images/circles.png' %}" alt="Decorative circles" class="w-32 h-auto mb-4"> <!-- Was w-16 -->

            <h2 class="text-4xl font-bold text-gray-800">Log in</h2>

            <!-- Error Messages -->
            {% if form.non_field_errors %}
                <div class="error-message">
                    {% for error in form.non_field_errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <form method="post" class="space-y-6" id="loginForm" novalidate>
                {% csrf_token %}
                
                <!-- Username Field -->
                <div>
                    <label for="{{ form.username.id_for_label }}" class="text-sm font-medium text-gray-700 block mb-2 opacity-80">
                        <i data-lucide="user" class="inline w-4 h-4 mr-1 text-gray-500"></i>
                        Username
                    </label>
                    <input 
                        type="text" 
                        id="{{ form.username.id_for_label }}" 
                        name="{{ form.username.name }}"
                        value="{{ form.username.value|default:'' }}"
                        placeholder="" 
                        class="custom-input"
                        autocomplete="username"
                        required
                    >
                    {% if form.username.errors %}
                        <div class="error-message">
                            {{ form.username.errors|first }}
                        </div>
                    {% endif %}
                </div>

                <!-- Password Field -->
                <div>
                    <label for="{{ form.password.id_for_label }}" class="text-sm font-medium text-gray-700 block mb-2 opacity-80">
                        <i data-lucide="lock" class="inline w-4 h-4 mr-1 text-gray-500"></i>
                        Password
                    </label>
                    <div class="relative">
                        <input 
                            type="password" 
                            id="{{ form.password.id_for_label }}" 
                            name="{{ form.password.name }}"
                            placeholder="" 
                            class="custom-input"
                            autocomplete="current-password"
                            required
                        >
                        <i 
                            data-lucide="eye-off" 
                            class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5 cursor-pointer hover:text-gray-600 transition duration-150" 
                            id="togglePasswordIcon"
                            onclick="togglePasswordVisibility()"
                        ></i>
                    </div>
                    {% if form.password.errors %}
                        <div class="error-message">
                            {{ form.password.errors|first }}
                        </div>
                    {% endif %}
                </div>

                <!-- Remember Me / Forgot Password -->
                <div class="flex justify-between items-center text-sm pt-2">
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input 
                            type="checkbox" 
                            name="remember_me" 
                            id="id_remember_me"
                            class="rounded-md border-gray-300 text-primary-btn focus:ring-primary-btn"
                            {% if form.remember_me.value %}checked{% endif %}
                        >
                        <span class="text-gray-600">Remember Me</span>
                    </label>
                    <a href="#" class="text-sm text-gray-500 hover:text-primary-btn transition duration-150">Forgot Password?</a>
                </div>

                <!-- Primary Login Button -->
                <button 
                    type="submit" 
                    class="w-full primary-btn text-white font-semibold py-3 rounded-xl hover:bg-blue-800 transition duration-200 shadow-md shadow-blue-500/50 mt-6 flex items-center justify-center"
                    id="submitBtn"
                >
                    <span class="spinner hidden" id="spinner"></span>
                    <span id="buttonText">Log in</span>
                </button>

                <!-- Separator -->
                <div class="flex items-center justify-center space-x-3 text-gray-400 py-1">
                    <hr class="flex-grow border-t border-gray-200">
                    <span class="text-sm">Or</span>
                    <hr class="flex-grow border-t border-gray-200">
                </div>

                <!-- Secondary Sign Up Button (Updated Style) -->
                <a 
                    href="{% url 'accounts:register' %}" 
                    class="w-full bg-gray-100 text-gray-800 font-semibold py-3 rounded-xl hover:bg-gray-200 transition duration-200 text-center block"
                >
                    Sign up
                </a>
            </form>
        </div>
    </div>

    <!-- Initialize Lucide Icons and add password toggle logic -->
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        function togglePasswordVisibility() {
            // Use a specific ID selector to avoid errors
            const passwordInput = document.getElementById('{{ form.password.id_for_label }}');
            const iconElement = document.getElementById('togglePasswordIcon');
            
            if (passwordInput && iconElement) {
                const isPassword = passwordInput.type === 'password';
                passwordInput.type = isPassword ? 'text' : 'password';
                
                // Update icon
                iconElement.setAttribute('data-lucide', isPassword ? 'eye' : 'eye-off');
                lucide.createIcons();
            }
        }

        // Form Loading State
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            const submitBtn = document.getElementById('submitBtn');
            const spinner = document.getElementById('spinner');
            const buttonText = document.getElementById('buttonText');

            if (loginForm && submitBtn) {
                loginForm.addEventListener('submit', function() {
                    // Check basic HTML5 validation
                    if (!loginForm.checkValidity()) {
                        return;
                    }
                    
                    // Disable submit button
                    submitBtn.disabled = true;
                    
                    // Show spinner
                    if (spinner) spinner.classList.remove('hidden');
                    
                    // Update button text
                    if (buttonText) {
                        buttonText.textContent = 'Logging in...';
                    }
                });
            }

            // Verify images are loaded (optional - for debugging)
            const logoImg = document.querySelector('.logo-img');
            if (logoImg) {
                logoImg.addEventListener('error', function() {
                    console.warn('⚠️ Logo image failed to load - check path: {% static "images/logo.png" %}');
                });
            }

            const circlesLeft = document.querySelector('.circles-image-left');
            if (circlesLeft) {
                circlesLeft.addEventListener('error', function() {
                     console.warn('⚠️ Circles image (left) failed to load - check path: {% static "images/circles.png" %}');
                });
            }
        });
    </script>
</body>
</html>
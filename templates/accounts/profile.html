{% extends 'base.html' %}

{% block title %}My Profile - Shop Hub{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-md-4">
            <!-- Profile Card -->
            <div class="card mb-4">
                <div class="card-body text-center">
                    {% if user.avatar %}
                        <img src="{{ user.avatar.url }}" alt="Avatar" class="rounded-circle mb-3" width="120" height="120" style="object-fit: cover;">
                    {% else %}
                        <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 120px; height: 120px;">
                            <i class="fas fa-user fa-3x"></i>
                        </div>
                    {% endif %}
                    <h4>{{ user.full_name|default:user.username }}</h4>
                    <p class="text-muted mb-2">{{ user.email }}</p>
                    <span class="badge bg-primary">
                        {% if user.role == 'buyer' %}
                            <i class="fas fa-shopping-cart me-1"></i>Buyer
                        {% elif user.role == 'seller' %}
                            <i class="fas fa-store me-1"></i>Seller
                        {% elif user.role == 'admin' %}
                            <i class="fas fa-user-shield me-1"></i>Admin
                        {% endif %}
                    </span>
                    {% if user.verified %}
                        <span class="badge bg-success ms-1">
                            <i class="fas fa-check-circle me-1"></i>Verified
                        </span>
                    {% endif %}
                </div>
            </div>

            <!-- Quick Actions -->
            {% if user.is_seller %}
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-store me-2"></i>Seller Actions</h6>
                </div>
                <div class="list-group list-group-flush">
                    <a href="{% url 'accounts:seller_dashboard' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </a>
                    <a href="{% url 'accounts:seller_profile_edit' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-edit me-2"></i>Edit Seller Profile
                    </a>
                </div>
            </div>
            {% endif %}
        </div>

        <div class="col-md-8">
            <!-- Edit Profile Form -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-user-edit me-2"></i>Edit Profile</h5>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data" novalidate id="profileForm">
                        {% csrf_token %}
                        
                        <div class="row">
                            <!-- Full Name -->
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.full_name.id_for_label }}" class="form-label">Full Name</label>
                                {{ form.full_name }}
                                {% if form.full_name.errors %}
                                    <div class="alert alert-danger d-flex align-items-center mt-1 py-1" role="alert">
                                        <i class="fas fa-exclamation-circle me-2"></i>
                                        <small>{{ form.full_name.errors|first }}</small>
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Phone -->
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.phone.id_for_label }}" class="form-label">Phone Number</label>
                                {{ form.phone }}
                                {% if form.phone.errors %}
                                    <div class="alert alert-danger d-flex align-items-center mt-1 py-1" role="alert">
                                        <i class="fas fa-exclamation-circle me-2"></i>
                                        <small>{{ form.phone.errors|first }}</small>
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row">
                            <!-- First Name -->
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.first_name.id_for_label }}" class="form-label">First Name</label>
                                {{ form.first_name }}
                                {% if form.first_name.errors %}
                                    <div class="alert alert-danger d-flex align-items-center mt-1 py-1" role="alert">
                                        <i class="fas fa-exclamation-circle me-2"></i>
                                        <small>{{ form.first_name.errors|first }}</small>
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Last Name -->
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.last_name.id_for_label }}" class="form-label">Last Name</label>
                                {{ form.last_name }}
                                {% if form.last_name.errors %}
                                    <div class="alert alert-danger d-flex align-items-center mt-1 py-1" role="alert">
                                        <i class="fas fa-exclamation-circle me-2"></i>
                                        <small>{{ form.last_name.errors|first }}</small>
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Avatar -->
                        <div class="mb-3">
                            <label for="{{ form.avatar.id_for_label }}" class="form-label">Profile Picture</label>
                            {{ form.avatar }}
                            {% if form.avatar.errors %}
                                <div class="alert alert-danger d-flex align-items-center mt-1 py-1" role="alert">
                                    <i class="fas fa-exclamation-circle me-2"></i>
                                    <small>{{ form.avatar.errors|first }}</small>
                                </div>
                            {% endif %}
                            {% if user.avatar %}
                                <small class="text-muted d-block mt-1">Current: {{ user.avatar.name }}</small>
                            {% endif %}
                            <!-- Avatar Preview -->
                            <div id="avatarPreview" class="mt-3" style="display: none;">
                                <img id="previewImg" src="#" alt="Preview" class="img-thumbnail" style="max-width: 200px; max-height: 200px; object-fit: cover;">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <span class="spinner-border spinner-border-sm d-none me-2" id="spinner" role="status" aria-hidden="true"></span>
                            <span id="buttonText">
                                <i class="fas fa-save me-2"></i>Save Changes
                            </span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Account Info -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Account Information</h6>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-4">Email:</dt>
                        <dd class="col-sm-8">{{ user.email }}</dd>
                        
                        <dt class="col-sm-4">Username:</dt>
                        <dd class="col-sm-8">{{ user.username }}</dd>
                        
                        <dt class="col-sm-4">Member Since:</dt>
                        <dd class="col-sm-8">{{ user.created_at|date:"F d, Y" }}</dd>
                        
                        <dt class="col-sm-4">Last Login:</dt>
                        <dd class="col-sm-8">{{ user.last_login|date:"F d, Y g:i A"|default:"Never" }}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Avatar Preview
    document.addEventListener('DOMContentLoaded', function() {
        const avatarInput = document.getElementById('id_avatar');
        const avatarPreview = document.getElementById('avatarPreview');
        const previewImg = document.getElementById('previewImg');

        if (avatarInput && avatarPreview && previewImg) {
            avatarInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImg.src = e.target.result;
                        avatarPreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    avatarPreview.style.display = 'none';
                }
            });
        }

        // Form Loading State
        const profileForm = document.getElementById('profileForm');
        const submitBtn = document.getElementById('submitBtn');
        const spinner = document.getElementById('spinner');
        const buttonText = document.getElementById('buttonText');

        if (profileForm && submitBtn) {
            profileForm.addEventListener('submit', function() {
                // Disable submit button
                submitBtn.disabled = true;
                
                // Show spinner
                if (spinner) spinner.classList.remove('d-none');
                
                // Update button text
                if (buttonText) {
                    buttonText.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
                }
            });
        }
    });
</script>
{% endblock %}

